<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Jump Host with VPN Client - Matthew McGovern</title>
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container"><div class="header__inner"><div class="header__logo">
            <a href="/"><img src="/assets/images/logo.png" alt="Matthew McGovern"></a><span class="header__title"><a href="/">MATTHEW MCGOVERN</a></span></div>
            <nav class="nav"><button class="nav-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav__list">
                <li><a href="/" class="nav__link">Home</a></li>
                <li><a href="/#about" class="nav__link">About</a></li>
                <li><a href="/#interests" class="nav__link">Interests</a></li>
                <li><a href="/blog/" class="nav__link nav__link--active">Posts</a></li>
                <li><a href="/resume/" class="nav__link">Resume</a></li>
            </ul><div class="social-links"><a href="mailto:matt@matthewmcgovern.com" title="Email"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></a><a href="https://github.com/matthern" target="_blank" rel="noopener" title="GitHub"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg></a></div></nav></div></div></header>

    <main class="post-content">
        <article>
            <header class="post-header">
                <h1>Setup Jump Host with VPN Client</h1>
                <div class="post-meta">
                    <span class="post-date">November 24, 2023</span>
                    <span class="post-author">Matthew McGovern</span>
                </div>
            </header>

            <div class="post-body">
                <p>A basic setup for a jump host which I have copied from my command history, this assumes wireguard is running on your server side network. This example is running an AWS ubuntu linux instance.</p>

                <h2>Install WireGuard</h2>
                <pre><code class="language-bash">sudo apt-get update
sudo apt-get install wireguard
cd /etc/wireguard/
umask 077
wg genkey > privatekey
wg pubkey < privatekey > publickey</code></pre>

                <h2>Configure WireGuard</h2>
                <p>Edit the config file. Change privatekey value to what was generated earlier and add pre-shared key. Change Allowed IPs to be the range of IPs connecting via the VPN.</p>

                <p><code>/etc/wireguard/wg0.conf</code></p>

                <pre><code class="language-bash">vi wg0.conf</code></pre>

                <pre><code class="language-ini">[Interface]
PrivateKey = somekey
Address = 10.7.0.13/24

[Peer]
PublicKey = kCjlPxD12n0xZf1Pa/KlCMgLii7LjjMEPcprBgQbqls=
PresharedKey = enterkey
AllowedIPs = 192.168.0.0/24
Endpoint = yourendpoint:51820
PersistentKeepalive = 25</code></pre>

                <h2>Enable IP Forwarding</h2>
                <p>Edit <code>/etc/sysctl.conf</code>:</p>

                <pre><code class="language-bash">vi /etc/sysctl.conf</code></pre>

                <pre><code class="language-bash">net.ipv4.ip_forward=1</code></pre>

                <p>Apply changes:</p>
                <pre><code class="language-bash">sysctl -p</code></pre>

                <h2>Configure Firewall</h2>
                <p>Install uncomplicated firewall and allow your wg port on udp, then start up wireguard tunnel:</p>

                <pre><code class="language-bash">sudo apt install ufw
sudo ufw allow ssh
sudo ufw allow 51820/udp</code></pre>

                <pre><code class="language-bash">sudo wg-quick up wg0</code></pre>

                <h2>Dynamic DNS (Optional)</h2>
                <p>If you have a domain name and need this jump VM to make sure its bound to it, we need to install ddclient or similar. This example uses namecheap, 'jump' is the subdomain:</p>

                <pre><code class="language-bash">sudo apt install ddclient</code></pre>

                <pre><code class="language-bash">vi /etc/ddclient.conf</code></pre>

                <pre><code class="language-ini"># FOR NAMECHEAP:
# Configuration file for ddclient generated by debconf
#
# /etc/ddclient.conf
use=web, web=dynamicdns.park-your-domain.com/getip
protocol=namecheap
server=dynamicdns.park-your-domain.com
login=domain.lol
password='from advanced dns'
jump</code></pre>

                <h2>Install Fail2ban</h2>
                <p>You would hope to disable password connection entirely and only allow keys, and on the public cloud or hypervisor/network layer not allow any connection except for your known IP range if possible. We can install fail2ban which will ban bots that try to connect to low hanging fruit and ban these at IP level:</p>

                <pre><code class="language-bash">sudo apt update
sudo apt install fail2ban
systemctl status fail2ban.service
sudo systemctl enable fail2ban
sudo systemctl start fail2ban</code></pre>

                <h2>Resources</h2>
                <ul>
                    <li><a href="https://www.wireguard.com/" target="_blank">WireGuard</a></li>
                    <li><a href="https://ddclient.net/" target="_blank">ddclient</a></li>
                    <li><a href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-20-04" target="_blank">How To Protect SSH With Fail2Ban on Ubuntu 20.04</a></li>
                </ul>
            </div>

            <nav class="post-navigation">
                <a href="/posts/how-to-create-nic-bonding-in-linux/" class="prev-post">‚Üê Previous: How to Create NIC Bonding in Linux</a>
            </nav>
        </article>
    </main>

    <footer class="footer">
        <div class="container"><div class="footer__inner"><nav class="footer__nav"><a href="/">Home</a><a href="/#about">About</a><a href="/#interests">Interests</a><a href="/resume/">Resume</a><a href="/blog/">Posts</a></nav>
            <p class="footer__copyright">&copy; 2024 Matthew McGovern. All rights reserved.</p></div></div></footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="/assets/js/main.js"></script>
</body>
</html>

