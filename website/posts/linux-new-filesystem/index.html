<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linux: Creating a New Filesystem Using Existing Location - Matthew McGovern</title>
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container"><div class="header__inner"><div class="header__logo">
            <a href="/"><img src="/assets/images/logo.png" alt="Matthew McGovern"></a><span class="header__title"><a href="/">MATTHEW MCGOVERN</a></span></div>
            <nav class="nav"><button class="nav-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav__list">
                <li><a href="/" class="nav__link">Home</a></li>
                <li><a href="/#about" class="nav__link">About</a></li>
                <li><a href="/#interests" class="nav__link">Interests</a></li>
                <li><a href="/blog/" class="nav__link nav__link--active">Posts</a></li>
                <li><a href="/resume/" class="nav__link">Resume</a></li>
            </ul><div class="social-links"><a href="mailto:matt@matthewmcgovern.com" title="Email"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></a><a href="https://github.com/matthern" target="_blank" rel="noopener" title="GitHub"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg></a></div></nav></div></div></header>

    <main class="post-content">
        <article>
            <header class="post-header">
                <h1>Linux: Creating a New Filesystem Using Existing Location</h1>
                <div class="post-meta">
                    <span class="post-date">July 1, 2023</span>
                    <span class="post-author">Matthew McGovern</span>
                </div>
            </header>

            <div class="post-body">
                <p>This was playing with filesystems on rocky linux 9. I found one situation where a VM had a root file system mounted directly to a 30GB device, which was filling up and causing issues as it was the location of the app and could not be extended. There was more storage available that could be allocated to some of the locations on this disk such as the app directory.</p>

                <p>A solution could be to mount this dir onto a new filesystem. In the below example I used /var. This assumes using super user. The idea being that we move the existing /var off the root filesystem and mount a new directory to its own filesystem.</p>

                <h2>Check Volume Groups</h2>
                <p>Firstly this is output of the 'vgs' command in this scenario. Volume group is named rl.</p>

                <pre><code class="language-bash">vgs

VG #PV #LV #SN Attr   VSize  VFree
rl   2   5   0 wz--n- 62.99g &lt;30.00g</code></pre>

                <h2>Create Logical Volume</h2>
                <p>Create lv, give it 2G, assign the name 'var' and format:</p>

                <pre><code class="language-bash">lvcreate -L 2G -n var rl

mkfs.xfs /dev/rl/var

# or for ext4:
mkfs.ext4 /dev/rl/var</code></pre>

                <h2>Boot into Rescue Mode</h2>
                <p>Backup data and copy over after mounting. To do this we dont want anything touching the files, one way is to boot into rescue mode (this is rocky/redhat 9 equiv to runlevel 1):</p>

                <p>Can only do this if you have access via console as no services or network will be running. Can then copy/move files without as much risk.</p>

                <p><a href="https://www.liquidweb.com/kb/linux-runlevels-explained/" target="_blank">Linux Runlevels Explained</a></p>

                <pre><code class="language-bash">systemctl isolate rescue.target

# To get back and to check which init or mode you are in:
systemctl isolate multi-user.target

systemctl get-default</code></pre>

                <h2>Mount and Migrate Data</h2>
                <p>Mount to file system, backup and move files and add to fstab so mount persists a reboot, using ext4 or xfs depending on partition created. After this, reboot system.</p>

                <pre><code class="language-bash">mkdir /newvar

mount /dev/rl/var /newvar

# backup old location:
cp -apx /var/* /newvar

mv /var /var.old

mkdir /var

# add to /etc/fstab:
/dev/mapper/rl-var      /var                    ext4    defaults        0 0

# can then reboot</code></pre>
            </div>

            <nav class="post-navigation">
                <a href="/posts/docker-cheat-sheet/" class="prev-post">← Previous: Docker Cheat Sheet</a>
                <a href="/posts/git-cheat-sheet/" class="next-post">Next: GIT Cheat Sheet →</a>
            </nav>
        </article>
    </main>

    <footer class="footer">
        <div class="container"><div class="footer__inner"><nav class="footer__nav"><a href="/">Home</a><a href="/#about">About</a><a href="/#interests">Interests</a><a href="/resume/">Resume</a><a href="/blog/">Posts</a></nav>
            <p class="footer__copyright">&copy; 2024 Matthew McGovern. All rights reserved.</p></div></div></footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="/assets/js/main.js"></script>
</body>
</html>

